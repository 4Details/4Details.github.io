---
title: MySQL数据库
tags: [MySQL]
category: []
---

1. MySQL数据库索引的基础——数据结构及算法
2. 各类索引
3. 高性能使用索引的策略

#  数据结构及算法基础

#  索引的本质

索引是帮助 MySQL 高效获取数据的数据结构。本质：索引是数据结构。

在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法——索引。

#  B树和B+树

### B树

### B+树

#  为什么使用B/B+树

红黑树等数据结构也可以用来实现索引，但是文件系统及数据库系统旁边采用B/B+作为索引结构。

一般来说，索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上。此时在查找过程中就会产生磁盘I/O消耗，相对于内存存取，I/O的消耗会高几个数量级，所以评价一个数据结构作为索引的优劣最为重要的指标就是在查找过程中磁盘I/O操作次数的渐进复杂度。即 索引的结构组织要尽量减少查找过程中磁盘I/O的存取次数。

##  主存存取

当系统需要读取主存时，则将地址信号放到地址总线上传给主存，主存读取到地址信号后，解析信号并定位到指定存储单元，然后将此存储单元地址放入数据总线，供其他部件读取；

写主存的过程类似，系统将要写入单元地址和数据分别放在地址总线和数据总线上，主存读取两个总线的内容，做相应的写操作。

因为不含机械操作，所以主存存取的时间仅与存取次数呈线性关系。

##  磁盘存取

当需要从磁盘读取数据时， 系统会将数据逻辑地址传给磁盘， 磁盘的控制电路按照寻址逻辑将逻辑地址翻译成物理地址， 即确定要读的数据在哪个磁道， 哪个扇区。 为了读取这个扇区的数据， 需要将磁头放到这个扇区上方， 为了实现这一点， 磁头需要移动对准相应磁道， 这个过程叫做**寻道**， 所耗费时间叫做**寻道时间**， 然后磁盘旋转将目标扇区旋转到磁头下， 这个过程耗费的时间叫做**旋转时间**。 

**局部性原理与预读**

由于存储介质的特性， 磁盘本身存取就比主存慢很多， 再加上机械运动耗费， 磁盘的存取速度往往是主存的几百分分之一， 因此为了提高效率， 要尽量减少磁盘I/O。 为了达到这个目的， 磁盘往往不是严格按需读取， 而是每次都会预读， 即使只需要一个字节， 磁盘也会从这个位置开始， 顺序向后读取一定长度的数据放入内存。 这样做的理论依据是计算机科学中著名的局部性原理：
​	当一个数据被用到时， 其附近的数据也通常会马上被使用。
​	程序运行期间所需要的数据通常比较集中。
​	由于磁盘顺序读取的效率很高（不需要寻道时间， 只需很少的旋转时间） ， 因此对于具有局部性的程序来说， 预读可以提高I/O效率。
​	
预读的长度一般为页（page） 的整倍数。 页是计算机管理存储器的逻辑块， 硬件及操作系统往往将主存和磁盘存储区分割为连续的大小相等的块， 每个存储块称为一页（在许多操作系统中， 页得大小通常为4k），主存和磁盘以页为单位交换数据。 当程序要读取的数据不在主存中时，会触发一个缺页异常， 此时系统会向磁盘发出读盘信号， 磁盘会找到数据的起始位置并向后连续读取一页或几页载入内存中， 然后异常返回，程序继续运行。 

##  B/B+索引性能分析

B树检索一次最多需要访问h个节点。数据库系统设计者利用磁盘预读原理，将一个节点的大小设为一个页，这样每个节点只需一次I/O就可以完全载入。

> 每次新建节点时， 直接申请一个页的空间， 这样就保证一个节点物理上也存储在一个页里， 加之计算机存储分配都是按页对齐的， 就实现了一个node只需一次I/O。 

B树一次检索最多需要h-1次I/O（根节点常驻内存），渐进复杂度是对数级，所以作为索引结构效率是非常高的。

红黑树h明显大很多，而且由于逻辑上很近的节点（父子）物理上可能很远，无法利用局部性原理，所以红黑树的I/O渐进复杂度为线性级，效率比B树差。

B+树更适合外存索引，原因是和内节点出度d有关。d越大索引的性能越好，而出度的上限取决于节点内key和data的大小
$$
dmax=floor(pagesize/(keysize+datasize+pointsize)) 
$$
B+树内节点去掉了data域，因此可以拥有更大的出度，有更好的性能。

#  MySQL索引实现

##  MyISAM索引实现

##  InnoDB索引实现

